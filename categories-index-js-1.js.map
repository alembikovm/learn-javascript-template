{"version":3,"sources":["webpack:///./src/components/notification/index.js","webpack:///./src/components/categories/index.js","webpack:///./src/pages/categories/index.js","webpack:///./src/utils/fetch-json.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/sortable-list/index.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","activeComponent","remove","element","document","createElement","innerHTML","template","firstElementChild","show","parent","body","append","setTimeout","destroy","templates","id","title","escapeHtml","count","Categories","data","event","preventDefault","target","isHeader","classList","contains","parentDiv","closest","toggle","async","children","payload","map","child","index","dataset","weight","send","showNotificationMessage","error","url","URL","process","requestParams","method","headers","JSON","stringify","fetchJson","wrapper","getCategoriesContainerTemplate","appendSubcategoryDraggableList","initEventListeners","addEventListener","toggleAccordion","onSortableListReorder","removeEventListeners","removeEventListener","getCategoryTemplate","join","createSubcategoryList","subcategories","getSortableListItemTemplate","subcategotyListArr","querySelectorAll","forEach","subcategoryElement","sortableList","SortableList","items","Page","fetchUrl","searchParams","set","initComponents","categories","components","subElements","getSubElements","getData","renderComponents","Object","keys","component","root","reduce","accum","subElement","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","Error","super","window","reason","alert","string","replace","clientX","clientY","moveDraggingAt","top","firstElementTop","getBoundingClientRect","bottom","movePlaceholderAt","length","i","li","draggingElem","offsetHeight","height","scrollIfCloseToWindowEdge","dragStop","className","addItems","onPointerDown","item","add","which","itemElem","dragStart","elementInitialIndex","indexOf","pointerInitialShift","x","y","placeholderElem","style","width","offsetWidth","after","onDocumentPointerMove","onDocumentPointerUp","left","scrollBy","documentElement","clientHeight","currentElement","insertBefore","placeholderIndex","replaceWith","dispatchEvent","CustomEvent","bubbles","details","from","to"],"mappings":"6RAAe,MAAMA,EAKjBC,YACEC,GACA,SACEC,EADF,KAEEC,GACE,IAAI,yBACRC,KAAKH,QAAUA,EACfG,KAAKF,SAAWA,EAChBE,KAAKD,KAAOA,EAEZC,KAAKC,SAGP,eACE,MAAQ,mDACkCD,KAAKD,6BAA6BC,KAAKF,SAAW,sEAEpFE,KAAKH,oDAMfI,SAEMN,EAAoBO,iBACtBP,EAAoBO,gBAAgBC,SAGtC,MAAMC,EAAUC,SAASC,cAAc,OACvCF,EAAQG,UAAYP,KAAKQ,SACzBR,KAAKI,QAAUA,EAAQK,kBACvBd,EAAoBO,gBAAkBF,KAAKI,QAG7CM,KAAKC,EAASN,SAASO,MACrBD,EAAOE,OAAOb,KAAKI,SAEnBU,WAAW,KACTd,KAAKG,UACJH,KAAKF,UAGVK,SACEH,KAAKI,QAAQD,SAGfY,UACEf,KAAKG,U,0HArDUR,E,0BCKrB,MAAMqB,EACM,EAAGC,KAAIC,WACd,sDAC8CD,+CACVE,YAAWD,uKAJ9CF,EAYc,EAAGC,KAAIC,QAAOE,WAAa,mGACiDH,oBAClFE,YAAWD,6BACVE,iCAIA,MAAMC,EAsCnBzB,YAAY0B,GAAM,kDAnCAC,IAChBA,EAAMC,iBACN,MAAM,OAAEC,GAAWF,EACbG,EAAWD,EAAOE,UAAUC,SAAS,oBACrCC,EAAYJ,EAAOK,QAAQ,OAE7BJ,GACFG,EAAUF,UAAUI,OAAO,mBA4Bb,+BAxBMC,UACtB,MAAM,OAAEP,GAAWF,GACb,SAAEU,GAAaR,EAEfS,EAAU,IAAID,GAAUE,IAAI,CAACC,EAAOC,KACxC,MAAM,GAAEpB,GAAOmB,EAAME,QAErB,MAAO,CACLrB,KACAsB,OAAQF,KAIZ,UACQrC,KAAKwC,KAAKN,GAChBlC,KAAKyC,wBAAwB,uBAAwB,CAAE1C,KAAM,YAC7D,MAAO2C,GACP1C,KAAKyC,wBAAyB,sBAAqBC,EAAS,CAC1D3C,KAAM,QACND,SAAU,SAMdE,KAAKsB,KAAOA,EACZtB,KAAKC,SAGPwC,wBAAwB5C,GAAS,SAAEC,EAAW,IAAb,KAAmBC,GAAS,IAC/B,IAAIJ,EAAoBE,EAAS,CAC3DC,SAAUA,EACVC,KAAMA,IAEYW,OAGtB,WAAWwB,GACT,MAAMS,EAAM,IAAIC,IAAI,yBAA0BC,oCACxCC,EAAgB,CACpBC,OAAQ,QACRC,QAAS,CACP,eAAgB,kCAElBpC,KAAMqC,KAAKC,UAAUhB,UAGjBiB,YAAUR,EAAKG,GAGvB7C,SACE,MAAMmD,EAAU/C,SAASC,cAAc,OAEvC8C,EAAQ7C,UAAYP,KAAKqD,+BAA+BrD,KAAKsB,MAE7D,MAAMlB,EAAUgD,EAAQ3C,kBAExBT,KAAKI,QAAUA,EAEfJ,KAAKsD,iCAELtD,KAAKuD,qBAGPA,qBACEvD,KAAKI,QAAQoD,iBAAiB,QAASxD,KAAKyD,iBAC5CzD,KAAKI,QAAQoD,iBAAiB,wBAAyBxD,KAAK0D,uBAG9DC,uBACE3D,KAAKI,QAAQwD,oBAAoB,QAAS5D,KAAKyD,iBAC/CzD,KAAKI,QAAQwD,oBAAoB,wBAAyB5D,KAAK0D,uBAGjEL,+BAA+B/B,GAC7B,MAAQ,6DAEFtB,KAAK6D,oBAAoBvC,yBAKjCuC,oBAAoBvC,GAClB,OAAOA,EAAKa,IAAInB,GAAuB8C,KAAK,IAG9CC,wBACE,OAAO/D,KAAKsB,KAAKa,IAAI/B,IACnB,MAAM,cAAE4D,EAAgB,IAAO5D,EAK/B,OAHc4D,EAAc7B,IAAI,EAAGlB,KAAIC,QAAOE,WAC5CpB,KAAKiE,4BAA4BhD,EAAIC,EAAOE,MAMlD6C,4BAA4BhD,EAAIC,EAAOE,GACrC,MAAMgC,EAAU/C,SAASC,cAAc,OAIvC,OAFA8C,EAAQ7C,UAAYS,EAA8B,CAAEC,KAAIC,QAAOE,UAExDgC,EAAQ3C,kBAGjB6C,iCACE,MAAMY,EAAqBlE,KAAK+D,wBACF/D,KAAKI,QAAQ+D,iBAAiB,oCAEtCC,QAAQ,CAACC,EAAoBhC,KACjD,MAAMiC,EAAe,IAAIC,IAAa,CAAEC,MAAON,EAAmB7B,KAElEgC,EAAmBxD,OAAOyD,EAAalE,WAI3CD,SACEH,KAAKI,QAAQD,SAGfY,UACEf,KAAK2D,uBACL3D,KAAKG,U,wHC1JM,MAAMsE,EAAK,4DAEV,IAFU,oBAGX,IAHW,cAIjB,IAEP,gBACE,MAAMC,EAAW,IAAI9B,IATF,sBADHC,oCAWhB6B,EAASC,aAAaC,IAAI,QAAS,UACnCF,EAASC,aAAaC,IAAI,QAAS,eACnC5E,KAAKsB,WAAa6B,YAAUuB,GAG9BG,iBAEE,MAAMC,EAAa,IAAIzD,EAAWrB,KAAKsB,MACvCtB,KAAK+E,WAAWD,WAAaA,EAG/B,eACE,MAAQ,4PAWV,eACE,MAAM1E,EAAUC,SAASC,cAAc,OAcvC,OAZAF,EAAQG,UAAYP,KAAKQ,SAEzBR,KAAKI,QAAUA,EAAQK,kBAEvBT,KAAKgF,YAAchF,KAAKiF,eAAejF,KAAKI,eAEtCJ,KAAKkF,UAEXlF,KAAK6E,iBAEL7E,KAAKmF,mBAEEnF,KAAKI,QAGd+E,mBACEC,OAAOC,KAAKrF,KAAK+E,YAAYX,QAAQkB,IACnC,MAAMC,EAAOvF,KAAKgF,YAAYM,IACxB,QAAElF,GAAYJ,KAAK+E,WAAWO,GACpCC,EAAK1E,OAAOT,KAIhB6E,eAAgB7E,GAGd,MAAO,IAFUA,EAAQ+D,iBAAiB,mBAErBqB,OAAO,CAACC,EAAOC,KAClCD,EAAMC,EAAWpD,QAAQlC,SAAWsF,EAE7BD,GACN,IAGL1E,UACE,IAAK,MAAMuE,KAAaF,OAAOO,OAAO3F,KAAK+E,YACzCO,EAAUvE,a,gCCvED,mBAAe4B,EAAKiD,GACjC,IAAIC,EASAjF,EAPJ,IAEEiF,QAAiBC,MAAMnD,EAAIoD,WAAYH,GACvC,MAAMI,GACN,MAAM,IAAIC,EAAWJ,EAAU,+BAKjC,IAAKA,EAASK,GAAI,CAChB,IAAIC,EAAYN,EAASO,WAEzB,IACExF,QAAaiF,EAASQ,OAEtBF,EAAavF,EAAK8B,OAAS9B,EAAK8B,MAAM7C,SAAae,EAAKU,MAAQV,EAAKU,KAAKoB,OAAS9B,EAAKU,KAAKoB,MAAM7C,SAAYsG,EAC/G,MAAOzD,IAET,IAAI7C,EAAW,SAAQgG,EAASS,WAAWH,IAE3C,MAAM,IAAIF,EAAWJ,EAAUjF,EAAMf,GAGvC,IACE,aAAagG,EAASQ,OACtB,MAAML,GACN,MAAM,IAAIC,EAAWJ,EAAU,KAAMG,EAAInG,WAItC,MAAMoG,UAAmBM,MAG9B3G,YAAYiG,EAAUjF,EAAMf,G,UAC1B2G,MAAM3G,G,EAHD,c,EAE8B,U,EAAA,M,sFAEnCG,KAAK6F,SAAWA,EAChB7F,KAAKY,KAAOA,GAKhB6F,OAAOjD,iBAAiB,qBAAsBjC,IACxCA,EAAMmF,kBAAkBT,GAC1BU,MAAMpF,EAAMmF,OAAO7G,Y,8BClDR+G,OAAUA,EACtBC,QAAQ,KAAM,SACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,S,uLCLF,MAAMtC,EA8CnB3E,aAAY,MAAC4E,EAAQ,IAAM,IAAI,wDA3CP,EAAEsC,UAASC,cACjC/G,KAAKgH,eAAeF,EAASC,GAE7B,MAAM,kBAACtG,EAAD,SAAoBwB,GAAYjC,KAAKI,SACpC6G,IAAKC,GAAmBzG,EAAkB0G,yBAC3C,OAACC,GAAUpH,KAAKI,QAAQ+G,wBAE9B,GAAIJ,EAAUG,EACZlH,KAAKqH,kBAAkB,QAClB,GAAIN,EAAUK,EACnBpH,KAAKqH,kBAAkBpF,EAASqF,aAEhC,IAAK,IAAIC,EAAI,EAAGA,EAAItF,EAASqF,OAAQC,IAAK,CACxC,MAAMC,EAAKvF,EAASsF,GAGpB,GAAIC,IAAOxH,KAAKyH,aAAc,CAC5B,MAAM,IAACR,EAAD,OAAMG,GAAUI,EAAGL,yBAClBO,aAAcC,GAAUH,EAE/B,GAAIT,EAAUE,GAAOF,EAAUK,EAAQ,CAErC,GAAIL,EAAUE,EAAMU,EAAS,EAAG,CAE9B3H,KAAKqH,kBAAkBE,GACvB,MAGAvH,KAAKqH,kBAAkBE,EAAI,GAC3B,QAOVvH,KAAK4H,0BAA0Bb,KAOF,6BAJT,KACpB/G,KAAK6H,aAIL7H,KAAKwE,MAAQA,EAEbxE,KAAKC,SAGPA,SACED,KAAKI,QAAUC,SAASC,cAAc,MACtCN,KAAKI,QAAQ0H,UAAY,gBAEzB9H,KAAK+H,WACL/H,KAAKuD,qBAGPA,qBACEvD,KAAKI,QAAQoD,iBAAiB,cAAejC,GAASvB,KAAKgI,cAAczG,IAG3EwG,WAEE,IAAK,IAAIE,KAAQjI,KAAKwE,MACpByD,EAAKtG,UAAUuG,IAAI,uBAGrBlI,KAAKI,QAAQS,UAAUb,KAAKwE,OAG9BwD,cAAczG,GACZ,GAAoB,IAAhBA,EAAM4G,MACR,OAAO,EAGT,MAAMC,EAAW7G,EAAME,OAAOK,QAAQ,wBAElCsG,IACE7G,EAAME,OAAOK,QAAQ,wBACvBP,EAAMC,iBAENxB,KAAKqI,UAAUD,EAAU7G,IAGvBA,EAAME,OAAOK,QAAQ,0BACvBP,EAAMC,iBAEN4G,EAASjI,WAKfkI,UAAUD,GAAU,QAACtB,EAAD,QAAUC,IAC5B/G,KAAKsI,oBAAsB,IAAItI,KAAKI,QAAQ6B,UAAUsG,QAAQH,GAE9DpI,KAAKwI,oBAAsB,CACzBC,EAAG3B,EAAUsB,EAASjB,wBAAwBsB,EAC9CC,EAAG3B,EAAUqB,EAASjB,wBAAwBuB,GAGhD1I,KAAKyH,aAAeW,EAEpBpI,KAAK2I,gBAAkBtI,SAASC,cAAc,MAC9CN,KAAK2I,gBAAgBb,UAAY,6BAIjCM,EAASQ,MAAMC,MAAWT,EAASU,YAAX,KACxBV,EAASQ,MAAMjB,OAAYS,EAASV,aAAX,KAEzB1H,KAAK2I,gBAAgBC,MAAMC,MAAQT,EAASQ,MAAMC,MAClD7I,KAAK2I,gBAAgBC,MAAMjB,OAASS,EAASQ,MAAMjB,OAEnDS,EAASzG,UAAUuG,IAAI,gCAEvBE,EAASW,MAAM/I,KAAK2I,iBAGpB3I,KAAKI,QAAQS,OAAOuH,GAEpBpI,KAAKgH,eAAeF,EAASC,GAE7B1G,SAASmD,iBAAiB,cAAexD,KAAKgJ,uBAC9C3I,SAASmD,iBAAiB,YAAaxD,KAAKiJ,qBAG9CjC,eAAeF,EAASC,GACtB/G,KAAKyH,aAAamB,MAAMM,KAAOpC,EAAU9G,KAAKwI,oBAAoBC,EAAI,KACtEzI,KAAKyH,aAAamB,MAAM3B,IAAMF,EAAU/G,KAAKwI,oBAAoBE,EAAI,KAGvEd,0BAA0Bb,GAIpBA,EAFc,GAGhBN,OAAO0C,SAAS,GAJK,IAKZpC,EAAU1G,SAAS+I,gBAAgBC,aAJ5B,IAKhB5C,OAAO0C,SAAS,EANK,IAUzB9B,kBAAkBhF,GAChB,MAAMiH,EAAiBtJ,KAAKI,QAAQ6B,SAASI,GAEzCiH,IAAmBtJ,KAAK2I,iBAC1B3I,KAAKI,QAAQmJ,aAAavJ,KAAK2I,gBAAiBW,GAIpDzB,WACE,MAAM2B,EAAmB,IAAIxJ,KAAKI,QAAQ6B,UAAUsG,QAAQvI,KAAK2I,iBAGjE3I,KAAK2I,gBAAgBc,YAAYzJ,KAAKyH,cACtCzH,KAAKyH,aAAa9F,UAAUxB,OAAO,gCAEnCH,KAAKyH,aAAamB,MAAMM,KAAO,GAC/BlJ,KAAKyH,aAAamB,MAAM3B,IAAM,GAC9BjH,KAAKyH,aAAamB,MAAMC,MAAQ,GAChC7I,KAAKyH,aAAamB,MAAMjB,OAAS,GAEjCtH,SAASuD,oBAAoB,cAAe5D,KAAKgJ,uBACjD3I,SAASuD,oBAAoB,YAAa5D,KAAKiJ,qBAE/CjJ,KAAKyH,aAAe,KAEhB+B,IAAqBxJ,KAAKsI,qBAC5BtI,KAAKI,QAAQsJ,cAAc,IAAIC,YAAY,wBAAyB,CAClEC,SAAS,EACTC,QAAS,CACPC,KAAM9J,KAAKsI,oBACXyB,GAAIP,MAMZrJ,SACEH,KAAKI,QAAQD,SACbE,SAASuD,oBAAoB,cAAe5D,KAAKgJ,uBACjD3I,SAASuD,oBAAoB,YAAa5D,KAAKiJ,qBAGjDlI,UACEf,KAAKG","file":"categories-index-js-1.js","sourcesContent":["export default class NotificationMessage {\n    static activeComponent;\n  \n    element; // HTMLElement;\n  \n    constructor(\n      message, \n      {\n        duration,\n        type\n      } = {}) {\n      this.message = message;\n      this.duration = duration;\n      this.type = type;\n      \n      this.render();\n    }\n  \n    get template() {\n      return `\n        <div class=\"notification notification_${this.type} show\" style=\"--value:${this.duration / 1000}s\">\n          <div class=\"notification__content\">\n            ${this.message}\n          </div>\n        </div>\n      `;\n    }\n  \n    render() {\n  \n      if (NotificationMessage.activeComponent) {\n        NotificationMessage.activeComponent.remove();\n      }\n  \n      const element = document.createElement('div');\n      element.innerHTML = this.template;\n      this.element = element.firstElementChild;\n      NotificationMessage.activeComponent = this.element;\n    }\n  \n    show(parent = document.body) {\n      parent.append(this.element);\n  \n      setTimeout(() => {\n        this.remove();\n      }, this.duration);\n    }\n  \n    remove() {\n      this.element.remove();\n    }\n  \n    destroy() {\n      this.remove();\n    }\n  }","import escapeHtml from '../../utils/escape-html.js';\nimport fetchJson from '../../utils/fetch-json.js';\nimport SortableList from '../../components/sortable-list/index.js';\nimport NotificationMessage from '../../components/notification/index.js';\n\nconst templates = {\n  category: ({ id, title }) =>\n    `\n    <div class=\"category category_open\" data-id=\"${id}\">\n      <header class=\"category__header\">${escapeHtml(title)}</header>\n      <div class=\"category__body\">\n        <div class=\"subcategory-list\" data-element=\"subcategoryList\">\n        </div>\n      </div>\n    </div>\n  `,\n\n  sortableListItem: ({ id, title, count }) => `\n  <li class=\"categories__sortable-list-item sortable-list__item\" data-grab-handle=\"\" data-id=\"${id}\">\n    <strong>${escapeHtml(title)}</strong>\n    <span><b>${count}</b> products</span>\n  </li>`\n};\n\nexport default class Categories {\n  element; //html element\n\n  toggleAccordion = event => {\n    event.preventDefault();\n    const { target } = event;\n    const isHeader = target.classList.contains('category__header');\n    const parentDiv = target.closest('div');\n\n    if (isHeader) {\n      parentDiv.classList.toggle('category_open');\n    }\n  };\n\n  onSortableListReorder = async event => {\n    const { target } = event;\n    const { children } = target;\n\n    const payload = [...children].map((child, index) => {\n      const { id } = child.dataset;\n\n      return {\n        id,\n        weight: index\n      };\n    });\n\n    try {\n      await this.send(payload);\n      this.showNotificationMessage('Category order saved', { type: 'success' });\n    } catch (error) {\n      this.showNotificationMessage(`Server side error! ${error}`, {\n        type: 'error',\n        duration: 3000\n      });\n    }\n  };\n\n  constructor(data) {\n    this.data = data;\n    this.render();\n  }\n\n  showNotificationMessage(message, { duration = 2000, type } = {}) {\n    const notificationMessage = new NotificationMessage(message, {\n      duration: duration,\n      type: type\n    });\n    notificationMessage.show();\n  }\n\n  async send(payload) {\n    const url = new URL('api/rest/subcategories', process.env.BACKEND_URL);\n    const requestParams = {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body: JSON.stringify(payload)\n    };\n\n    await fetchJson(url, requestParams);\n  }\n\n  render() {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = this.getCategoriesContainerTemplate(this.data);\n\n    const element = wrapper.firstElementChild;\n\n    this.element = element;\n\n    this.appendSubcategoryDraggableList();\n\n    this.initEventListeners();\n  }\n\n  initEventListeners() {\n    this.element.addEventListener('click', this.toggleAccordion);\n    this.element.addEventListener('sortable-list-reorder', this.onSortableListReorder);\n  }\n\n  removeEventListeners() {\n    this.element.removeEventListener('click', this.toggleAccordion);\n    this.element.removeEventListener('sortable-list-reorder', this.onSortableListReorder);\n  }\n\n  getCategoriesContainerTemplate(data) {\n    return `\n      <div data-element=\"categoriesContainer\">\n        ${this.getCategoryTemplate(data)}\n      </div>\n    `;\n  }\n\n  getCategoryTemplate(data) {\n    return data.map(templates['category']).join('');\n  }\n\n  createSubcategoryList() {\n    return this.data.map(element => {\n      const { subcategories = [] } = element;\n\n      const items = subcategories.map(({ id, title, count }) =>\n        this.getSortableListItemTemplate(id, title, count)\n      );\n      return items;\n    });\n  }\n\n  getSortableListItemTemplate(id, title, count) {\n    const wrapper = document.createElement('div');\n\n    wrapper.innerHTML = templates['sortableListItem']({ id, title, count });\n\n    return wrapper.firstElementChild;\n  }\n\n  appendSubcategoryDraggableList() {\n    const subcategotyListArr = this.createSubcategoryList();\n    const subcategoryElementArr = this.element.querySelectorAll(\"[data-element='subcategoryList']\");\n\n    subcategoryElementArr.forEach((subcategoryElement, index) => {\n      const sortableList = new SortableList({ items: subcategotyListArr[index] });\n\n      subcategoryElement.append(sortableList.element);\n    });\n  }\n\n  remove() {\n    this.element.remove();\n  }\n\n  destroy() {\n    this.removeEventListeners();\n    this.remove();\n  }\n}\n","import Categories from '../../components/categories/index.js';\nimport fetchJson from '../../utils/fetch-json.js';\n\nconst BACKEND_URL = process.env.BACKEND_URL;\nconst CATEGORIES_URL = \"api/rest/categories\";\n\nexport default class Page {\n  element;\n  subElements = {};\n  components = {};\n  data = {};\n\n  async getData () {\n    const fetchUrl = new URL(CATEGORIES_URL, BACKEND_URL);\n    fetchUrl.searchParams.set(\"_sort\", \"weight\");\n    fetchUrl.searchParams.set(\"_refs\", \"subcategory\");\n    this.data = await fetchJson(fetchUrl);\n  }\n\n  initComponents () {\n\n    const categories = new Categories(this.data);\n    this.components.categories = categories;\n  }\n\n  get template () {\n    return `\n    <div class=\"categories\">\n      <div class=\"content__top-panel\">\n        <h1 class=\"page-title\">Категории товаров</h1>\n      </div>\n      <div data-element=\"categories\">\n        <!-- categories component -->\n      </div>\n    </div>`;\n  }\n\n  async render () {\n    const element = document.createElement('div');\n\n    element.innerHTML = this.template;\n\n    this.element = element.firstElementChild;\n    \n    this.subElements = this.getSubElements(this.element);\n\n    await this.getData();\n\n    this.initComponents();\n\n    this.renderComponents();\n\n    return this.element;\n  }\n\n  renderComponents () {\n    Object.keys(this.components).forEach(component => {\n      const root = this.subElements[component];\n      const { element } = this.components[component];\n      root.append(element);\n    });\n  }\n\n  getSubElements (element) {\n    const elements = element.querySelectorAll('[data-element]');\n\n    return [...elements].reduce((accum, subElement) => {\n      accum[subElement.dataset.element] = subElement;\n\n      return accum;\n    }, {});\n  }\n\n  destroy () {\n    for (const component of Object.values(this.components)) {\n      component.destroy();\n    }\n  }\n}","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","export default class SortableList {\r\n  element;\r\n\r\n  onDocumentPointerMove = ({clientX, clientY}) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const {firstElementChild, children} = this.element;\r\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\r\n    const {bottom} = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      this.movePlaceholderAt(0);\r\n    } else if (clientY > bottom) {\r\n      this.movePlaceholderAt(children.length);\r\n    } else {\r\n      for (let i = 0; i < children.length; i++) {\r\n        const li = children[i];\r\n\r\n        // ignore to prevent bugs when dragging between elements\r\n        if (li !== this.draggingElem) {\r\n          const {top, bottom} = li.getBoundingClientRect();\r\n          const {offsetHeight: height} = li;\r\n\r\n          if (clientY > top && clientY < bottom) {\r\n            // inside the element (y-axis)\r\n            if (clientY < top + height / 2) {\r\n              // upper half of the element\r\n              this.movePlaceholderAt(i);\r\n              break;\r\n            } else {\r\n              // lower half of the element\r\n              this.movePlaceholderAt(i + 1);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onDocumentPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({items = []} = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', event => this.onPointerDown(event));\r\n  }\r\n\r\n  addItems() {\r\n    // item is a DOM element\r\n    for (let item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  onPointerDown(event) {\r\n    if (event.which !== 1) { // must be left-button\r\n      return false;\r\n    }\r\n\r\n    const itemElem = event.target.closest('.sortable-list__item');\r\n\r\n    if (itemElem) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n\r\n        this.dragStart(itemElem, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        itemElem.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  dragStart(itemElem, {clientX, clientY}) {\r\n    this.elementInitialIndex = [...this.element.children].indexOf(itemElem);\r\n\r\n    this.pointerInitialShift = {\r\n      x: clientX - itemElem.getBoundingClientRect().x,\r\n      y: clientY - itemElem.getBoundingClientRect().y\r\n    };\r\n\r\n    this.draggingElem = itemElem;\r\n\r\n    this.placeholderElem = document.createElement('li');\r\n    this.placeholderElem.className = 'sortable-list__placeholder';\r\n\r\n    // itemElem will get position:fixed\r\n    // so its width will be auto-set to fit the parent container\r\n    itemElem.style.width = `${itemElem.offsetWidth}px`;\r\n    itemElem.style.height = `${itemElem.offsetHeight}px`;\r\n\r\n    this.placeholderElem.style.width = itemElem.style.width;\r\n    this.placeholderElem.style.height = itemElem.style.height;\r\n\r\n    itemElem.classList.add('sortable-list__item_dragging');\r\n\r\n    itemElem.after(this.placeholderElem);\r\n\r\n    // move to the end, to be over other list elements\r\n    this.element.append(itemElem);\r\n\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    document.addEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.addEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = clientX - this.pointerInitialShift.x + 'px';\r\n    this.draggingElem.style.top = clientY - this.pointerInitialShift.y + 'px';\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  movePlaceholderAt(index) {\r\n    const currentElement = this.element.children[index];\r\n\r\n    if (currentElement !== this.placeholderElem) {\r\n      this.element.insertBefore(this.placeholderElem, currentElement);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\r\n\r\n    // drop element back\r\n    this.placeholderElem.replaceWith(this.draggingElem);\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n\r\n    this.draggingElem.style.left = '';\r\n    this.draggingElem.style.top = '';\r\n    this.draggingElem.style.width = '';\r\n    this.draggingElem.style.height = '';\r\n\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n\r\n    this.draggingElem = null;\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        details: {\r\n          from: this.elementInitialIndex,\r\n          to: placeholderIndex\r\n        }\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}\r\n"],"sourceRoot":""}